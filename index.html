<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>E-Bike Route with Live Map: Davis Square to Danvers</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Warm Neutrals -->
    <!-- Application Structure Plan: A mobile-first, interactive journey planner. The structure now features a prominent, live Google Map as the primary visual element. Below or beside it (depending on screen size) is the familiar accordion of route segments. Clicking a segment now performs two actions: it expands the turn-by-turn directions and simultaneously updates the live map to zoom in on that specific segment's path. This provides a seamless, intuitive link between textual directions and geographical context, which is critical for mobile navigation. -->
    <!-- Visualization & Content Choices: Report Info: Geographic route data and turn-by-turn directions. Goal: Provide a live, interactive navigation experience. Viz/Presentation Method: An interactive Google Map (Google Maps JS API) for visualization and an HTML/JS accordion for text details. Interaction: Clicking a segment header updates the map's viewport (zoom/pan) and draws the relevant polyline for that segment. Justification: This directly addresses the user's request for a "live map" and is the standard, most effective way to present route data for active navigation on a mobile device. Static images are replaced with a far superior, interactive tool. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #FDFBF8;
            color: #3f3f46;
        }
        #map {
            height: 100%;
            width: 100%;
            border-radius: 0.75rem;
        }
        .route-segment-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease-in-out;
        }
        .route-segment-content.open {
            max-height: 500px;
        }
        .path-type-icon {
            display: inline-block;
            width: 24px;
            height: 24px;
            line-height: 24px;
            text-align: center;
            border-radius: 50%;
            margin-right: 8px;
            font-size: 14px;
        }
        .trail-icon { background-color: #dcfce7; color: #166534; }
        .road-icon { background-color: #fee2e2; color: #991b1b; }
        .active-segment { background-color: #ecfdf5 !important; border-color: #10b981; }
    </style>
</head>
<body class="antialiased">
    <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-12">
        <header class="text-center mb-12">
            <h1 class="text-4xl md:text-5xl font-bold text-zinc-800 tracking-tight">E-Bike Route Planner</h1>
            <p class="mt-4 text-lg text-zinc-600">Davis Square, Somerville to 530 Maple St, Danvers</p>
        </header>
        
        <div class="bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700 p-4 rounded-md mb-8" role="alert">
            <p class="font-bold">Important Note</p>
            <p>To enable the interactive map, you must replace `"YOUR_GOOGLE_MAPS_API_KEY"` in the HTML file with your own Google Maps JavaScript API key.</p>
        </div>

        <main class="grid lg:grid-cols-3 gap-8 max-w-7xl mx-auto">
            <div class="lg:col-span-2">
                <div class="bg-white rounded-xl shadow-md p-4 sticky top-8">
                    <h2 class="text-2xl font-bold text-zinc-800 mb-4 text-center">Live Route Map</h2>
                    <div id="map-container" class="w-full h-96 lg:h-[70vh] bg-zinc-200 rounded-lg">
                        <div id="map"></div>
                    </div>
                </div>
            </div>
            <div class="lg:col-span-1">
                 <div class="bg-white rounded-xl shadow-md p-6">
                    <h2 class="text-2xl font-bold text-zinc-800 mb-4">Route Segments</h2>
                    <p class="text-zinc-600 mb-6">Click a segment to see details and update the map.</p>
                    <div id="route-segments-container" class="space-y-4">
                    </div>
                 </div>
            </div>
        </main>
        
        <section id="safety" class="max-w-4xl mx-auto bg-white rounded-xl shadow-md p-8 mt-12">
            <h2 class="text-2xl font-bold text-zinc-800 mb-4">Safety & Trail Etiquette</h2>
            <ul class="space-y-4 text-zinc-600 list-disc list-inside">
                <li><span class="font-semibold">Be Predictable:</span> Ride in a straight line and avoid sudden swerving. Use hand signals to indicate turns and stops.</li>
                <li><span class="font-semibold">Announce Your Pass:</span> When passing other trail users, give a friendly audible warning like "On your left!" well in advance.</li>
                <li><span class="font-semibold">Control Your Speed:</span> E-bikes can be fast. Adjust your speed for conditions, especially in congested areas. The speed limit on many trails is 15 mph.</li>
            </ul>
        </section>
    </div>

    <script>
        const routeData = [
            {
                title: "Segment 1: Davis Sq. to Northern Strand",
                distance: "~3.5 miles",
                type: "trail",
                icon: 'ðŸš²',
                path: [ {lat: 42.3969, lng: -71.1223}, {lat: 42.3921, lng: -71.0945}, {lat: 42.3942, lng: -71.0772} ],
                description: `<ul class="list-disc list-inside space-y-2 pl-4 text-zinc-600"><li>Start in Davis Square and head east on the Somerville Community Path.</li><li>Follow the path towards the new Green Line Extension.</li><li>This new section of path will lead you directly to the connection for the Northern Strand Community Trail.</li></ul>`
            },
            {
                title: "Segment 2: The Northern Strand Trail",
                distance: "~11.5 miles",
                type: "trail",
                icon: 'ðŸš²',
                path: [ {lat: 42.3942, lng: -71.0772}, {lat: 42.4120, lng: -71.0620}, {lat: 42.4418, lng: -71.0189}, {lat: 42.4646, lng: -70.9782}, {lat: 42.4800, lng: -70.9500} ],
                description: `<ul class="list-disc list-inside space-y-2 pl-4 text-zinc-600"><li>This is the longest, most straightforward part of your ride. Simply stay on the paved path.</li><li>The trail will take you north through Everett, Malden, Revere, and Saugus.</li><li>Continue following the path all the way to its current terminus in Lynn.</li></ul>`
            },
            {
                title: "Segment 3: On-Road (Lynn to Peabody)",
                distance: "~3 miles",
                type: "road",
                icon: 'ðŸš—',
                path: [ {lat: 42.4800, lng: -70.9500}, {lat: 42.4883, lng: -70.9504}, {lat: 42.5065, lng: -70.9723}, {lat: 42.5188, lng: -70.9632} ],
                description: `<ul class="list-disc list-inside space-y-2 pl-4 text-zinc-600"><li>From the end of the Northern Strand: head north on Western Ave, left on Chestnut St, right on Goodridge St.</li><li>Continue on Prospect St until you reach Peabody. Turn left onto Lowell St.</li><li>Look for the entrance to the Independence Greenway on your right.</li></ul>`
            },
            {
                title: "Segment 4: The Independence Greenway",
                distance: "~6 miles",
                type: "trail",
                icon: 'ðŸš²',
                path: [ {lat: 42.5188, lng: -70.9632}, {lat: 42.5340, lng: -70.9535}, {lat: 42.5458, lng: -70.9318}, {lat: 42.5594, lng: -70.9163} ],
                description: `<ul class="list-disc list-inside space-y-2 pl-4 text-zinc-600"><li>You're back on a paved rail trail! Follow the Independence Greenway as it winds through Peabody.</li><li>The path goes through woodlands and crosses several small roads.</li><li>The path will take you towards the Danvers town line.</li></ul>`
            },
            {
                title: "Segment 5: Final stretch to Maple St",
                distance: "~1.5 miles",
                type: "road",
                icon: 'ðŸš—',
                path: [ {lat: 42.5594, lng: -70.9163}, {lat: 42.5649, lng: -70.9231}, {lat: 42.5700, lng: -70.9310}, {lat: 42.5735, lng: -70.9348} ],
                description: `<ul class="list-disc list-inside space-y-2 pl-4 text-zinc-600"><li>From the end of the trail, navigate onto Endicott St.</li><li>Turn right onto Sylvan St, then left onto Maple St.</li><li>Follow Maple St to your destination at number 530. Congratulations!</li></ul>`
            }
        ];
        
        let map;
        let activePolylines = [];

        function initMap() {
            const mapOptions = {
                center: { lat: 42.48, lng: -71.02 },
                zoom: 11,
                mapTypeId: 'roadmap',
                disableDefaultUI: true,
                zoomControl: true,
                styles: [
                    { featureType: "poi", stylers: [{ visibility: "off" }] },
                    { featureType: "transit", stylers: [{ visibility: "off" }] }
                ]
            };
            map = new google.maps.Map(document.getElementById("map"), mapOptions);
            
            buildAccordion();
            setupEventListeners();
            displayFullRoute();
        }

        function buildAccordion() {
            const segmentsContainer = document.getElementById('route-segments-container');
            segmentsContainer.innerHTML = '';
            routeData.forEach((segment, index) => {
                const segmentEl = document.createElement('div');
                segmentEl.className = 'border border-zinc-200 rounded-lg';
                segmentEl.innerHTML = `
                    <button class="segment-toggle w-full text-left p-4 flex justify-between items-center bg-zinc-50 hover:bg-zinc-100 transition-colors duration-200" data-index="${index}">
                        <div class="flex items-center pointer-events-none">
                            <span class="path-type-icon ${segment.type === 'trail' ? 'trail-icon' : 'road-icon'}">${segment.icon}</span>
                            <span class="font-semibold text-md text-zinc-700">${segment.title}</span>
                        </div>
                        <div class="flex items-center pointer-events-none">
                            <svg class="w-6 h-6 text-zinc-500 transform transition-transform duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                        </div>
                    </button>
                    <div class="route-segment-content">
                        <div class="p-6 bg-white border-t border-zinc-200 rounded-b-lg">
                            ${segment.description}
                        </div>
                    </div>`;
                segmentsContainer.appendChild(segmentEl);
            });
        }
        
        function clearPolylines() {
            activePolylines.forEach(line => line.setMap(null));
            activePolylines = [];
        }

        function displaySegment(index) {
            clearPolylines();
            const segment = routeData[index];
            const bounds = new google.maps.LatLngBounds();

            const polyline = new google.maps.Polyline({
                path: segment.path,
                geodesic: true,
                strokeColor: segment.type === 'trail' ? '#10b981' : '#ef4444',
                strokeOpacity: 0.9,
                strokeWeight: 6
            });
            
            polyline.setMap(map);
            activePolylines.push(polyline);
            segment.path.forEach(point => bounds.extend(point));
            map.fitBounds(bounds, {padding: 50});
        }

        function displayFullRoute() {
            clearPolylines();
            const bounds = new google.maps.LatLngBounds();
            routeData.forEach(segment => {
                 const polyline = new google.maps.Polyline({
                    path: segment.path,
                    geodesic: true,
                    strokeColor: segment.type === 'trail' ? '#10b981' : '#ef4444',
                    strokeOpacity: 0.7,
                    strokeWeight: 5
                });
                polyline.setMap(map);
                activePolylines.push(polyline);
                segment.path.forEach(point => bounds.extend(point));
            });
            map.fitBounds(bounds, {padding: 20});
        }

        function setupEventListeners() {
            const segmentsContainer = document.getElementById('route-segments-container');
            segmentsContainer.addEventListener('click', (event) => {
                const button = event.target.closest('button.segment-toggle');
                if (!button) return;

                const index = button.dataset.index;
                displaySegment(index);
                
                const allButtons = segmentsContainer.querySelectorAll('.segment-toggle');
                allButtons.forEach(btn => btn.classList.remove('active-segment'));
                button.classList.add('active-segment');
                
                const content = button.nextElementSibling;
                const wasOpen = content.classList.contains('open');

                document.querySelectorAll('.route-segment-content.open').forEach(openContent => {
                    if (openContent !== content) {
                       openContent.classList.remove('open');
                       openContent.previousElementSibling.querySelector('svg').classList.remove('rotate-180');
                    }
                });
                
                content.classList.toggle('open');
                button.querySelector('svg').classList.toggle('rotate-180');
            });
        }

    </script>
    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCTaKX_0GtN42Z-oAN-ubW5ZqokymqMRCI"></script>
</body>
</html>

